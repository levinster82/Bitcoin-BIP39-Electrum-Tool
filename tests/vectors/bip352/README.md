# BIP-352 Silent Payments Test Vectors

This directory contains test vectors for BIP-352 Silent Payments implementation.

## Files

### Official BIP-352 Vectors
- **send_and_receive_test_vectors.json** - Official test vectors from BIP-352 specification
  - 26 test cases covering transaction-level sending/receiving
  - Tests ECDH, tweaking, and output detection
  - Does NOT include BIP39/BIP32 derivation testing

### Custom Derivation Test Vectors
- **derivation_test_vectors_js.json** - Generated by JavaScript implementation
- **derivation_test_vectors_py.json** - Generated by Python implementation
- **16 comprehensive test vectors** covering BIP39 → BIP32 → BIP-352 full derivation

#### Test Coverage
1. **BIP39 Test Vector 1** - Standard 24-word mnemonic (abandon abandon...)
   - 3 accounts (0, 1, 2) × 3 address indices (0, 1, 2) = 9 vectors

2. **BIP39 Test Vector 2** - Standard 12-word mnemonic (legal winner...)
   - 2 accounts (0, 1) × 2 address indices (0, 1) = 4 vectors

3. **BIP39 with Passphrase** - 12-word + "TREZOR" passphrase
   - 1 account (0) × 2 address indices (0, 1) = 2 vectors

4. **12-word Mnemonic** - Edge case (zoo zoo... wrong)
   - 1 account (0) × 1 address index (0) = 1 vector

**Total: 16 test vectors**

### Each Vector Contains
- Mnemonic phrase and passphrase
- BIP39 seed (hex)
- BIP32 root extended keys (xprv/xpub)
- Account and address index
- Derivation paths for scan and spend keys
  - Scan: `m/352'/0'/account'/1'/address_index`
  - Spend: `m/352'/0'/account'/0'/address_index`
- Scan key (private, public, xprv, xpub)
- Spend key (private, public, xprv, xpub)
- Final Silent Payment address (sp1q...)

## Generators

### JavaScript Generator
```bash
npm install
node generate-test-vectors.js
```
Outputs: `derivation_test_vectors_js.json`

### Python Generator
```bash
python3 -m venv venv
source venv/bin/activate
pip install mnemonic bip32
python3 generate-test-vectors.py
```
Outputs: `derivation_test_vectors_py.json`

### Cross-Implementation Verification
```bash
node compare-vectors.js
```
Compares all fields from both implementations to ensure correctness.

## Validation Results

✅ **All 16 test vectors match perfectly** between JavaScript and Python implementations.

This cross-implementation validation provides high confidence in the correctness of:
- BIP39 seed generation
- BIP32 hierarchical derivation
- BIP-352 key derivation paths
- Silent Payment address encoding (bech32m)

## Usage in Tests

These vectors can be used to validate:
1. BIP39 mnemonic → seed conversion
2. BIP32 root key derivation from seed
3. BIP-352 specific derivation paths (m/352'/0'/account'/change'/address_index)
4. Silent Payment address encoding
5. Extended key generation (xprv/xpub)

## Implementation Notes

- All addresses use **mainnet** (sp1q... prefix)
- Uses **bech32m encoding** (not bech32)
- Extended keys use standard BIP32 encoding (xprv/xpub, not yprv/zpub)
- All public keys are compressed (33 bytes, 02/03 prefix)
- Derivation follows BIP-352 specification exactly
